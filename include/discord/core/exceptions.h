#pragma once

#include <string>
#include <stdexcept>
#include <nlohmann/json.hpp>

namespace discord {

enum class ErrorCode {
    UNKNOWN_ERROR = 0,
    UNKNOWN_ACCOUNT = 10001,
    UNKNOWN_APPLICATION = 10002,
    UNKNOWN_CHANNEL = 10003,
    UNKNOWN_GUILD = 10004,
    UNKNOWN_INTEGRATION = 10005,
    UNKNOWN_INVITE = 10006,
    UNKNOWN_MEMBER = 10007,
    UNKNOWN_MESSAGE = 10008,
    UNKNOWN_OVERWRITE = 10009,
    UNKNOWN_PROVIDER = 10010,
    UNKNOWN_ROLE = 10011,
    UNKNOWN_TOKEN = 10012,
    UNKNOWN_USER = 10013,
    UNKNOWN_EMOJI = 10014,
    UNKNOWN_WEBHOOK = 10015,
    UNKNOWN_WEBHOOK_SERVICE = 10016,
    UNKNOWN_SESSION = 10020,
    UNKNOWN_BAN = 10026,
    UNKNOWN_SKU = 10027,
    UNKNOWN_STORE_LISTING = 10028,
    UNKNOWN_ENTITLEMENT = 10029,
    UNKNOWN_BUILD = 10030,
    UNKNOWN_LOBBY = 10031,
    UNKNOWN_BRANCH = 10032,
    UNKNOWN_STORE_DIRECTORY_LAYOUT = 10033,
    UNKNOWN_REDISTRIBUTABLE = 10036,
    UNKNOWN_GIFT_CODE = 10038,
    UNKNOWN_STREAM = 10049,
    UNKNOWN_PREMIUM_SERVER_SUBSCRIPTION_COOLDOWN = 10050,
    UNKNOWN_GUILD_TEMPLATE = 10057,
    UNKNOWN_DISCOVERABLE_SERVER_CATEGORY = 10059,
    UNKNOWN_STICKER = 10060,
    UNKNOWN_INTERACTION = 10062,
    UNKNOWN_APPLICATION_COMMAND = 10063,
    UNKNOWN_APPLICATION_COMMAND_PERMISSIONS = 10066,
    UNKNOWN_STAGE_INSTANCE = 10067,
    UNKNOWN_GUILD_MEMBER_VERIFICATION_FORM = 10068,
    UNKNOWN_GUILD_WELCOME_SCREEN = 10069,
    UNKNOWN_GUILD_SCHEDULED_EVENT = 10070,
    UNKNOWN_GUILD_SCHEDULED_EVENT_USER = 10071,
    UNKNOWN_GUILD_ONBOARDING = 10072,
    
    BOTS_NOT_ALLOWED = 20001,
    ONLY_BOTS_ALLOWED = 20002,
    UNAUTHORIZED_HTTP = 20003,
    ACCOUNT_VERIFICATION_REQUIRED_HTTP = 20004,
    DIRECT_MESSAGES_TOO_FAST = 20016,
    REQUEST_ENTITY_TOO_LARGE_HTTP = 20018,
    FEATURE_TEMPORARILY_DISABLED_HTTP = 20022,
    USER_BANNED_HTTP = 20026,
    TARGET_USER_NOT_CONNECTED_TO_VOICE_HTTP = 20028,
    
    MAXIMUM_GUILDS = 30001,
    MAXIMUM_FRIENDS = 30002,
    MAXIMUM_PINS = 30003,
    MAXIMUM_RECIPIENTS = 30004,
    MAXIMUM_ROLES = 30005,
    MAXIMUM_WEBHOOKS = 30007,
    MAXIMUM_EMOJIS = 30008,
    MAXIMUM_REACTIONS = 30010,
    MAXIMUM_CHANNELS = 30013,
    MAXIMUM_ATTACHMENTS = 30015,
    MAXIMUM_INVITES = 30016,
    MAXIMUM_ANIMATED_EMOJIS = 30018,
    MAXIMUM_GUILD_MEMBERS = 30030,
    MAXIMUM_GUILD_ONBOARDING_PROMPTS = 30031,
    
    UNAUTHORIZED = 40001,
    ACCOUNT_VERIFICATION_REQUIRED = 40002,
    OPEN_DIRECT_MESSAGES_ONLY = 40003,
    REQUEST_ENTITY_TOO_LARGE = 40005,
    FEATURE_TEMPORARILY_DISABLED = 40006,
    USER_BANNED = 40007,
    CONNECTION_REVOKED = 40012,
    TARGET_USER_NOT_CONNECTED_TO_VOICE = 40032,
    ALREADY_CROSSPOSTED = 40033,
    MISSING_ACCESS = 50001,
    INVALID_ACCOUNT_TYPE = 50002,
    CANNOT_EXECUTE_ON_DM = 50003,
    EMBED_DISABLED = 50004,
    CANNOT_EDIT_MESSAGE_BY_OTHER = 50005,
    CANNOT_SEND_EMPTY_MESSAGE = 50006,
    CANNOT_MESSAGE_USER = 50007,
    CANNOT_SEND_MESSAGES_IN_NON_TEXT_CHANNEL = 50008,
    CHANNEL_VERIFICATION_LEVEL_TOO_HIGH = 50009,
    OAUTH2_APPLICATION_BOT_ABSENT = 50010,
    MAXIMUM_OAUTH2_APPLICATIONS = 50011,
    INVALID_OAUTH2_STATE = 50012,
    MISSING_PERMISSIONS = 50013,
    INVALID_AUTHENTICATION_TOKEN = 50014,
    NOTE_TOO_LONG = 50015,
    INVALID_BULK_DELETE_QUANTITY = 50016,
    CANNOT_PIN_MESSAGE_IN_OTHER_CHANNEL = 50019,
    INVALID_OR_TAKEN_INVITE_CODE = 50020,
    CANNOT_EXECUTE_ON_SYSTEM_MESSAGE = 50021,
    INVALID_OAUTH2_ACCESS_TOKEN = 50025,
    MISSING_OAUTH2_SCOPE = 50026,
    INVALID_WEBHOOK_TOKEN = 50027,
    INVALID_ROLE = 50028,
    INVALID_RECIPIENTS = 50033,
    INVALID_MESSAGE_TYPE = 50034,
    INVALID_PIN_MESSAGE = 50035,
    INVALID_OR_TAKEN_STICKER = 50036,
    INVALID_STICKER_SENT = 50037,
    INVALID_API_VERSION = 50041,
    FILE_UPLOADED_EXCEEDS_MAXIMUM_SIZE = 50045,
    INVALID_FILE_UPLOADED = 50046,
    INVALID_GUILD = 50055,
    INVALID_MESSAGE_FLAGS = 50068,
    INVALID_ASSET = 50074,
    INVALID_SKU = 50078,
    INVALID_LOBBY = 50081,
    INVALID_LOBBY_TYPE = 50083,
    INVALID_LOCATION_METADATA = 50084,
    INVALID_VOICE_STATE = 50085,
    INVALID_PANEL_BUILDER = 50086,
    INVALID_ONBOARDING = 50091,
    CANNOT_DELETE_COMMUNITY_REQUIRED_CHANNEL = 50094,
    INVALID_STICKER_SENT_V2 = 50095,
    INVALID_COMMAND_TYPE = 50097,
    INVALID_ONBOARDING_PROMPT_TITLE = 50098,
    INVALID_ONBOARDING_PROMPT_OPTIONS = 50099,
    INVALID_ONBOARDING_PROMPT_OPTION_TITLE = 50100,
    INVALID_ONBOARDING_PROMPT_OPTION_DESCRIPTION = 50101,
    INVALID_ONBOARDING_DEFAULT_CHANNEL_IDS = 50102,
    INVALID_ONBOARDING_DEFAULT_CHANNEL_IDS_COUNT = 50103,
    INVALID_ONBOARDING_MODE = 50104,
    INVALID_SORT_ORDER = 50105,
    INVALID_GUILD_ONBOARDING = 50106,
    TOO_MANY_ONBOARDING_PROMPTS = 50107,
    TOO_MANY_ONBOARDING_PROMPT_OPTIONS = 50108,
    INVALID_ONBOARDING_PROMPT_OPTION_EMOJI = 50109,
    INVALID_ONBOARDING_PROMPT_OPTION_EMOJI_NAME = 50110,
    INVALID_ONBOARDING_PROMPT_OPTION_EMOJI_ID = 50111,
    
    RATE_LIMITED = 10001,
    ACCOUNT_VERIFICATION_REQUIRED_GATEWAY = 10002,
    INVALID_API_VERSION_GATEWAY = 10003,
    TEMPORARY_OUTAGE = 10004,
    SERVER_ERROR = 10005,
    INVALID_GATEWAY_INTENTS = 10006,
    INVALID_INTENTS = 10007,
    DISALLOWED_INTENTS = 10008
};

class DiscordException : public std::exception {
public:
    DiscordException(int code, const std::string& message, const nlohmann::json& response = {});
    
    const char* what() const noexcept override;
    int get_code() const;
    const std::string& get_message() const;
    const nlohmann::json& get_response() const;
    
    static DiscordException from_response(const nlohmann::json& response);

private:
    int code_;
    std::string message_;
    nlohmann::json response_;
    std::string full_message_;
};

class RateLimitException : public DiscordException {
public:
    RateLimitException(int retry_after, const std::string& message);
    int get_retry_after() const;

private:
    int retry_after_;
};

class WebSocketException : public DiscordException {
public:
    WebSocketException(int close_code, const std::string& message);
    int get_close_code() const;

private:
    int close_code_;
};

class AuthenticationException : public DiscordException {
public:
    AuthenticationException(const std::string& message);
};

class PermissionException : public DiscordException {
public:
    PermissionException(const std::string& message);
};

class ValidationException : public DiscordException {
public:
    ValidationException(const std::string& message);
};

}